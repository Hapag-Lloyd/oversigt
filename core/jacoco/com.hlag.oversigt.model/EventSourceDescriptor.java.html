<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EventSourceDescriptor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Oversigt Core</a> &gt; <a href="index.source.html" class="el_package">com.hlag.oversigt.model</a> &gt; <span class="el_source">EventSourceDescriptor.java</span></div><h1>EventSourceDescriptor.java</h1><pre class="source lang-java linenums">package com.hlag.oversigt.model;

import static java.util.Optional.empty;

import java.util.Collections;
import java.util.LinkedHashSet;
import java.util.Objects;
import java.util.Optional;
import java.util.Set;
import java.util.TreeSet;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonProperty.Access;
import com.google.common.base.Strings;
import com.google.common.util.concurrent.Service;
import com.google.inject.Module;
import com.hlag.oversigt.controller.EventSourceKey;
import com.hlag.oversigt.core.event.OversigtEvent;
import com.hlag.oversigt.core.eventsource.EventSource.NOP;
import com.hlag.oversigt.core.eventsource.ScheduledEventSource;

import edu.umd.cs.findbugs.annotations.Nullable;

public final class EventSourceDescriptor implements Comparable&lt;EventSourceDescriptor&gt; {
	@NotNull
	private final EventSourceKey key;

	@NotBlank
	@NotNull
	private final String displayName;

	private final Optional&lt;String&gt; description;

	@NotBlank
	@JsonProperty(access = Access.READ_ONLY, required = false)
	private final String view;

	private final Optional&lt;Class&lt;? extends Service&gt;&gt; serviceClass;

	private final Optional&lt;Class&lt;? extends OversigtEvent&gt;&gt; eventClass;

	@JsonIgnore
	private final Class&lt;? extends Module&gt; moduleClass;

	private final boolean standAlone;

	@NotNull
	private final Set&lt;@NotNull EventSourceProperty&gt; properties;

	@NotNull
	private final Set&lt;@NotNull EventSourceProperty&gt; dataItems;

	@JsonIgnore
	private final Set&lt;@NotBlank String&gt; dataItemsToHide;

	private EventSourceDescriptor(final EventSourceKey key,
			final String displayName,
			final Optional&lt;String&gt; description,
			final String view,
			final Optional&lt;Class&lt;? extends Service&gt;&gt; serviceClass,
			final Optional&lt;Class&lt;? extends OversigtEvent&gt;&gt; eventClass,
			final Class&lt;? extends Module&gt; moduleClass,
			final boolean standAlone,
			final Set&lt;EventSourceProperty&gt; properties,
			final Set&lt;EventSourceProperty&gt; dataItems,
<span class="nc" id="L70">			final Set&lt;String&gt; dataItemsToHide) {</span>
<span class="nc" id="L71">		this.key = key;</span>
<span class="nc" id="L72">		this.displayName = displayName;</span>
<span class="nc" id="L73">		this.description = description;</span>
<span class="nc" id="L74">		this.view = view;</span>
<span class="nc" id="L75">		this.serviceClass = serviceClass;</span>
<span class="nc" id="L76">		this.eventClass = eventClass;</span>
<span class="nc" id="L77">		this.moduleClass = moduleClass;</span>
<span class="nc" id="L78">		this.standAlone = standAlone;</span>
<span class="nc" id="L79">		this.properties = Collections.unmodifiableSet(new LinkedHashSet&lt;&gt;(properties));</span>
<span class="nc" id="L80">		this.dataItems = Collections.unmodifiableSet(new LinkedHashSet&lt;&gt;(dataItems));</span>
<span class="nc" id="L81">		this.dataItemsToHide = Collections.unmodifiableSet(new LinkedHashSet&lt;&gt;(dataItemsToHide));</span>
<span class="nc" id="L82">	}</span>

	public EventSourceKey getKey() {
<span class="nc" id="L85">		return key;</span>
	}

	public String getView() {
<span class="nc" id="L89">		return view;</span>
	}

	public Optional&lt;Class&lt;? extends Service&gt;&gt; getServiceClass() {
<span class="nc" id="L93">		return serviceClass;</span>
	}

	@JsonProperty(access = Access.READ_ONLY, required = false)
	@Nullable
	public String getServiceClassName() {
<span class="nc" id="L99">		return serviceClass.map(Class::getName).orElse(null);</span>
	}

	@JsonProperty(access = Access.READ_ONLY, required = false)
	@Nullable
	public String getEventClassName() {
<span class="nc" id="L105">		return eventClass.map(Class::getName).orElse(null);</span>
	}

	@JsonIgnore
	public boolean isScheduledService() {
<span class="nc" id="L110">		return serviceClass.map(ScheduledEventSource.class::isAssignableFrom).orElse(false);</span>
	}

	public boolean isDeprecated() {
<span class="nc" id="L114">		return serviceClass.map(clazz -&gt; clazz.isAnnotationPresent(Deprecated.class)).orElse(false);</span>
	}

	@Nullable
	public Class&lt;? extends OversigtEvent&gt; getEventClass() {
<span class="nc" id="L119">		return eventClass.orElse(null);</span>
	}

	public Class&lt;? extends Module&gt; getModuleClass() {
<span class="nc" id="L123">		return moduleClass;</span>
	}

	public String getDisplayName() {
<span class="nc" id="L127">		return displayName;</span>
	}

	public Optional&lt;String&gt; getDescription() {
<span class="nc" id="L131">		return description;</span>
	}

	public Set&lt;EventSourceProperty&gt; getProperties() {
<span class="nc" id="L135">		return Collections.unmodifiableSet(properties);</span>
	}

	public Set&lt;EventSourceProperty&gt; getDataItems() {
<span class="nc" id="L139">		return Collections.unmodifiableSet(dataItems);</span>
	}

	public Set&lt;String&gt; getDataItemsToHide() {
<span class="nc" id="L143">		return Collections.unmodifiableSet(dataItemsToHide);</span>
	}

	EventSourceProperty getProperty(final String name) {
<span class="nc" id="L147">		return properties.stream().filter(p -&gt; name.equals(p.getName())).findAny().get();</span>
	}

	EventSourceProperty getDataItem(final String name) {
<span class="nc" id="L151">		return dataItems.stream().filter(p -&gt; name.equals(p.getName())).findAny().get();</span>
	}

	// TODO make non-public
	public boolean isStandAlone() {
<span class="nc" id="L156">		return standAlone;</span>
	}

	@Override
	public int compareTo(@Nullable final EventSourceDescriptor that) {
<span class="nc" id="L161">		return getDisplayName()</span>
<span class="nc" id="L162">				.compareToIgnoreCase(Optional.ofNullable(that).map(EventSourceDescriptor::getDisplayName).orElse(&quot;&quot;));</span>
	}

	@Override
	public String toString() {
<span class="nc" id="L167">		return key + &quot; (&quot; + displayName + &quot; / &quot; + view + &quot;)&quot;;</span>
	}

	public static final class Builder {
		private final EventSourceKey key;

		private final String displayName;

		private final Optional&lt;String&gt; description;

		private final String view;

		private final Optional&lt;Class&lt;? extends Service&gt;&gt; serviceClass;

		private final Optional&lt;Class&lt;? extends OversigtEvent&gt;&gt; eventClass;

		private final Class&lt;? extends Module&gt; moduleClass;

		private final boolean standAlone;

<span class="nc" id="L187">		private final Set&lt;EventSourceProperty&gt; properties = new TreeSet&lt;&gt;();</span>

<span class="nc" id="L189">		private final Set&lt;EventSourceProperty&gt; dataItems = new TreeSet&lt;&gt;();</span>

<span class="nc" id="L191">		private final Set&lt;String&gt; dataItemsToHide = new TreeSet&lt;&gt;();</span>

		public Builder(final EventSourceKey key,
				final String displayName,
				final Optional&lt;String&gt; description,
				final String view,
<span class="nc" id="L197">				final boolean standAlone) {</span>
<span class="nc" id="L198">			this.key = key;</span>
<span class="nc" id="L199">			this.displayName = displayName;</span>
<span class="nc" id="L200">			this.description = description;</span>
<span class="nc" id="L201">			this.view = view;</span>
<span class="nc" id="L202">			serviceClass = empty();</span>
<span class="nc" id="L203">			eventClass = empty();</span>
<span class="nc" id="L204">			moduleClass = NOP.class;</span>
<span class="nc" id="L205">			this.standAlone = standAlone;</span>
<span class="nc" id="L206">		}</span>

		public Builder(final EventSourceKey key,
				final String displayName,
				final String description,
				final String view,
				final Class&lt;? extends Service&gt; serviceClass,
				final Class&lt;? extends OversigtEvent&gt; eventClass,
<span class="nc" id="L214">				final Class&lt;? extends Module&gt; moduleClass) {</span>
<span class="nc" id="L215">			this.key = key;</span>
<span class="nc" id="L216">			this.displayName = displayName;</span>
<span class="nc" id="L217">			this.description = Optional.of(description);</span>
<span class="nc" id="L218">			this.view = view;</span>
<span class="nc" id="L219">			this.serviceClass = Optional.of(serviceClass);</span>
<span class="nc" id="L220">			this.eventClass = Optional.of(eventClass);</span>
<span class="nc" id="L221">			this.moduleClass = moduleClass;</span>
<span class="nc" id="L222">			standAlone = false;</span>
<span class="nc" id="L223">		}</span>

		public String getView() {
<span class="nc" id="L226">			return view;</span>
		}

		public Set&lt;String&gt; getDataItemsToHide() {
<span class="nc" id="L230">			return dataItemsToHide;</span>
		}

		public void addProperty(final EventSourceProperty property) {
<span class="nc" id="L234">			properties.add(Objects.requireNonNull(property, &quot;Property must not be null&quot;));</span>
<span class="nc" id="L235">		}</span>

		public void addDataItem(final EventSourceProperty dataItem) {
<span class="nc" id="L238">			dataItems.add(Objects.requireNonNull(dataItem, &quot;Data item must not be null&quot;));</span>
<span class="nc" id="L239">		}</span>

		public void addDataItemToHide(final String itemName) {
<span class="nc" id="L242">			dataItemsToHide</span>
<span class="nc" id="L243">					.add(Objects.requireNonNull(Strings.emptyToNull(itemName), &quot;Item name must not be null or empty&quot;));</span>
<span class="nc" id="L244">		}</span>

		public EventSourceDescriptor build() {
<span class="nc" id="L247">			return new EventSourceDescriptor(key,</span>
					displayName,
					description,
					view,
					serviceClass,
					eventClass,
					moduleClass,
					standAlone,
					properties,
					dataItems,
					dataItemsToHide);
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>