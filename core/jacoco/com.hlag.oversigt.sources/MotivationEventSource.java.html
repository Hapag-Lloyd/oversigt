<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MotivationEventSource.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Oversigt Core</a> &gt; <a href="index.source.html" class="el_package">com.hlag.oversigt.sources</a> &gt; <span class="el_source">MotivationEventSource.java</span></div><h1>MotivationEventSource.java</h1><pre class="source lang-java linenums">package com.hlag.oversigt.sources;

import java.time.DayOfWeek;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.ZoneId;
import java.time.ZonedDateTime;
import java.time.temporal.ChronoUnit;
import java.util.Optional;

import com.hlag.oversigt.core.eventsource.DataItemDefault;
import com.hlag.oversigt.core.eventsource.EventSource;
import com.hlag.oversigt.core.eventsource.ScheduledEventSource;
import com.hlag.oversigt.sources.event.MeterEvent;

@SuppressWarnings(&quot;checkstyle:OperatorWrap&quot;)
@EventSource(view = &quot;Meter&quot;,
		displayName = &quot;Motivation&quot;,
		description = &quot;Compute semi-random numbers depending on time of day and other things.&quot;,
		hiddenDataItems = { &quot;height&quot;, &quot;moreinfo&quot;, &quot;updated-at-message&quot;, &quot;width&quot; },
		dataItemDefaults = {
				@DataItemDefault(name = &quot;min&quot;, value = &quot;0&quot;),
				@DataItemDefault(name = &quot;max&quot;, value = &quot;100&quot;) })
public class MotivationEventSource extends ScheduledEventSource&lt;MeterEvent&gt; {
<span class="nc" id="L25">	private static final ZoneId HERE = ZoneId.of(&quot;Europe/Berlin&quot;);</span>

<span class="nc" id="L27">	private static final LocalTime START_ZEIT = LocalTime.of(7, 0);</span>

<span class="nc" id="L29">	private static final LocalTime STOP_ZEIT = LocalTime.of(17, 15);</span>

<span class="nc" id="L31">	public MotivationEventSource() {</span>
		// no fields to be initialized
<span class="nc" id="L33">	}</span>

	@Override
	protected Optional&lt;MeterEvent&gt; produceEvent() {
<span class="nc" id="L37">		final ZonedDateTime now = ZonedDateTime.now(HERE);</span>
<span class="nc" id="L38">		ZonedDateTime start = getStartingTime();</span>
<span class="nc" id="L39">		ZonedDateTime stop = getQuittingTime();</span>

		double motivation;

		// Consider time of day
<span class="nc bnc" id="L44" title="All 4 branches missed.">		if (start.isBefore(now) &amp;&amp; stop.isAfter(now)) {</span>
			// Motivation goes down...
<span class="nc" id="L46">			final double minutesToWork = ChronoUnit.MINUTES.between(start, stop);</span>
<span class="nc" id="L47">			final double minutesLeft = ChronoUnit.MINUTES.between(now, stop);</span>

<span class="nc" id="L49">			motivation = minutesLeft / minutesToWork;</span>
<span class="nc" id="L50">		} else {</span>
			// Motivation goes up...
<span class="nc" id="L52">			start = start.plusDays(1);</span>
<span class="nc" id="L53">			stop = stop.plusDays(1);</span>
<span class="nc" id="L54">			final double minutesToWork = ChronoUnit.MINUTES.between(stop, start);</span>
<span class="nc" id="L55">			final double minutesLeft = ChronoUnit.MINUTES.between(now, start);</span>

<span class="nc" id="L57">			motivation = (minutesToWork - minutesLeft) / minutesToWork;</span>
		}

		// consider day of week
<span class="nc" id="L61">		final DayOfWeek dow = now.getDayOfWeek();</span>
<span class="nc" id="L62">		final double offset = dow.ordinal() * 0.05;</span>
<span class="nc" id="L63">		final double factor = 1.0 - DayOfWeek.values().length * 0.05;</span>
<span class="nc" id="L64">		motivation = offset + motivation * factor;</span>

<span class="nc" id="L66">		return Optional.of(new MeterEvent((byte) (motivation * 100 + 0.5)));</span>
	}

	private static ZonedDateTime getStartingTime() {
<span class="nc" id="L70">		return START_ZEIT.atDate(LocalDate.now()).atZone(HERE);</span>
	}

	private static ZonedDateTime getQuittingTime() {
<span class="nc" id="L74">		return STOP_ZEIT.atDate(LocalDate.now()).atZone(HERE);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>